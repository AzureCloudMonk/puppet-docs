---
layout: default
title: "ロールとプロファイル：概要"
---

<p> Puppetは一般的に、<em>完全なシステム構成</em>を構築するために使用されます。一定のシステム上で、すべてのソフトウェア、サービス、および重要なシステムを管理します。
</p>

<p> 特にシステム構成の構築は、管理対象のシステムが複雑な場合は困難が伴うことがあります。 その複雑さを抑えるため、再利用可能で設定しやすく、リファクタリングも容易に行えるコードを記述する必要があります。
</p>

<p> <strong>ロールとプロファイル</strong>手法は、再利用、設定、リファクタリングが可能なシステム構成を最も確実に構築できる方法です。 しかし、これは決して単純な手段ではありません。インフラとチームの性質について熟考する必要があります。 また、これは最終的な状態でもありません。設定は時間をかけて調整していきます。 むしろ、<em>インフラのインターフェースを設計</em>するためのアプローチであると言えます。付帯的な複雑さを抑制し、重大な複雑さを明らかにして、データが予測可能な動作をするようにします。
</p>

<h2 id="a-summary-of-the-roles-and-profiles-method">ロールおよびプロファイル手法の概要</h2>

<p> ロールとプロファイルは、ノード分類子とコンポーネントモジュール間にある、<strong>2つの追加的な間接レイヤ</strong>です。 これにより、コードが次の3つのレベルに分けられます。
</p>

<ul>
<li>
<strong>コンポーネントモジュール: </strong> 特定のテクノロジを管理する通常のモジュール(例:  puppetlabs/apache)。</li>
  <li>
<strong>プロファイル：</strong> 複数のコンポーネントモジュールを使用し、レイヤ化されたテクノロジスタックを構成するラッパークラス。</li>
  <li>
<strong>ロール：</strong> 複数のプロファイルを使用し、完全なシステム構成を構築するラッパークラス。</li>
</ul>
<p> これら2つの追加的な間接レイヤにより複雑さが増すように見えますが、実際には、非常に重要な設定に対して、実用的かつビジネスに特化したインターフェースを構築するスペースが与えられます。 優れたインターフェースがあれば、階層データが使いやすく、システム設定が読みやすく、リファクタリングが行いやすくなります。
</p>

<p> <img src="./images/roles_and_profiles_overview.png" alt="Diagram: NC assigns one role to group of nodes; role declares several profiles; profiles declare resources and classes from component modules, as well as core resources and other profiles.&lt;/p&gt; &lt;p class=" temp-sentence>"&gt;
</p>

<p> 簡単に言うと、上から下に次のように行われます。
</p>

<ul>
<li>ノード分類子が、1つの<strong>ロール</strong>クラスをノードのグループに割り当てます。ロールはシステム構成全体を管理するため、他のクラスは必要ありません。NCは、どのような方法であれロールを設定しません。</li>
  <li>
    <p> そのロールクラスは、<code>include</code>を使用して<strong>プロファイル</strong>を宣言し、他のことは何も行いません。 例えば以下のようなものです。
</p>

    <pre><code class="language-puppet">class role::jenkins::master {
  include profile::base
  include profile::server
  include profile::jenkins::master
}
</code></pre>
  </li>
  <li>各プロファイルは、複数のコンポーネントモジュールと内蔵のリソースタイプを使用し、レイヤ化されたテクノロジスタックを設定します(図では、<code>profile::jenkins::master</code>はrtyler/jenkins、puppetlabs/apt、自作のバックアップモジュール、<code>package</code>および<code>file</code>リソースを使用します)。</li>
  <li>プロファイルはHieraまたはPuppetルックアップから設定データを取り出します(図では、3つの異なる階層レベルがデータに寄与します)。</li>
  <li>コンポーネントモジュールのクラスは常にプロファイル経由で宣言され、ノードには直接割り当てられません。<ul>
<li>コンポーネントクラスにパラメータがある場合、<em>プロファイル</em>で指定します。HieraまたはPuppetルックアップを使用し、コンポーネントクラスパラメータをオーバーライドしないでください。</li>
    </ul>
</li>
</ul>
<h2 id="building-configurations-without-roles-and-profiles">ロールとプロファイルを使用せずに構成を構築する</h2>

<p> ロールとプロファイルがない場合、システム構成は一般的にノード分類子か<a href="%7B%7Bpuppet%7D%7D/dirs_manifest.html">mainマニフェスト</a>で構築されます。面倒な継承の問題については、Hieraを使用します。 標準的なアプローチとしては、類似ノードのグループを作成し、そのグループに対してクラスを割り当ててから、子グループを作成します。このとき、他にニーズがあるノードに対しては、クラスを余分に追加します。 もう1つの一般的なパターンとしては、インフラのすべてのバリエーションを反映する非常に大きな階層を使用して、すべてをHieraに格納するという方法もあります。
</p>

<p> これが可能であれば問題ありません。 その場合はロールやプロファイルは必要ありません。 しかし、時間が経つにつれて直接的な構築はわかりづらく、かつメンテナンスも困難になることがほとんどです。
</p>

<h2 id="next-steps">次の手順</h2>

<p> ロールとプロファイルの手法がわかったところで、 <a href="./r_n_p_full_example.html">適度に簡略化されたワークフローの例</a>でその使い方を学びます。
</p>
</div>
